<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Help you transform into an Android platform framework with AOP architecture"><meta name=author content=FlyJingFish><link href=https://flyjingfish.github.io/AndroidAOP/AndroidAopReplaceClass/ rel=canonical><link href=../AndroidAopMatchClassMethod/ rel=prev><link href=../AndroidAopModifyExtendsClass/ rel=next><link rel=icon href=../assets/web_logo.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.18"><title>@AndroidAopReplaceClass - AndroidAOP</title><link rel=stylesheet href=../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/site.css><link rel=stylesheet href=../css/logo_anim.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#brief-description class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=AndroidAOP class="md-header__button md-logo" aria-label=AndroidAOP data-md-component=logo> <img src=../assets/web_logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AndroidAOP </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> @AndroidAopReplaceClass </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label="Select language"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=.. hreflang=en class=md-select__link> English </a> </li> <li class=md-select__item> <a href=../zh/ hreflang=zh class=md-select__link> 中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/FlyJingFish/AndroidAOP title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> FlyJingFish/AndroidAOP </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class="md-tabs__item md-tabs__item--active"> <a href=.. class=md-tabs__link> English </a> </li> <li class=md-tabs__item> <a href=../zh/ class=md-tabs__link> 中文 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=AndroidAOP class="md-nav__button md-logo" aria-label=AndroidAOP data-md-component=logo> <img src=../assets/web_logo.png alt=logo> </a> AndroidAOP </label> <div class=md-nav__source> <a href=https://github.com/FlyJingFish/AndroidAOP title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> FlyJingFish/AndroidAOP </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex> <span class=md-ellipsis> English </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=true> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> English </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../getting_started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../android_aop_extra/ class=md-nav__link> <span class=md-ellipsis> Extension Library </span> </a> </li> <li class=md-nav__item> <a href=../AndroidAopPointCut/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopPointCut </span> </a> </li> <li class=md-nav__item> <a href=../AndroidAopMatchClassMethod/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopMatchClassMethod </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> @AndroidAopReplaceClass </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> @AndroidAopReplaceClass </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#brief-description class=md-nav__link> <span class=md-ellipsis> Brief description </span> </a> </li> <li class=md-nav__item> <a href=#1-description class=md-nav__link> <span class=md-ellipsis> 1. Description </span> </a> <nav class=md-nav aria-label="1. Description"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#androidaopreplaceclass class=md-nav__link> <span class=md-ellipsis> @AndroidAopReplaceClass </span> </a> </li> <li class=md-nav__item> <a href=#androidaopreplacenew class=md-nav__link> <span class=md-ellipsis> @AndroidAopReplaceNew </span> </a> </li> <li class=md-nav__item> <a href=#androidaopreplacemethod class=md-nav__link> <span class=md-ellipsis> @AndroidAopReplaceMethod </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-matching-rules class=md-nav__link> <span class=md-ellipsis> 2. Matching rules </span> </a> </li> <li class=md-nav__item> <a href=#3-use-cases class=md-nav__link> <span class=md-ellipsis> 3. Use cases </span> </a> <nav class=md-nav aria-label="3. Use cases"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-java-writing class=md-nav__link> <span class=md-ellipsis> 1. Java writing </span> </a> </li> <li class=md-nav__item> <a href=#2-kotlin-writing-method class=md-nav__link> <span class=md-ellipsis> 2. Kotlin writing method </span> </a> <nav class=md-nav aria-label="2. Kotlin writing method"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#if-the-replaced-function-is-modified-with-suspend-then-you-can-only-write-it-in-kotlin-code-and-the-replacement-function-must-also-be-modified-with-suspend class=md-nav__link> <span class=md-ellipsis> If the replaced function is modified with suspend, then you can only write it in Kotlin code, and the replacement function must also be modified with suspend </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-construction-method class=md-nav__link> <span class=md-ellipsis> 3. Construction method </span> </a> </li> <li class=md-nav__item> <a href=#4-proxy-usage-of-androidaopmatchclassmethod class=md-nav__link> <span class=md-ellipsis> 4. Proxy usage of @AndroidAopMatchClassMethod </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../AndroidAopModifyExtendsClass/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopModifyExtendsClass </span> </a> </li> <li class=md-nav__item> <a href=../AndroidAopCollectMethod/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopCollectMethod </span> </a> </li> <li class=md-nav__item> <a href=../AOP_Helper/ class=md-nav__link> <span class=md-ellipsis> AOP-Code Helper </span> </a> </li> <li class=md-nav__item> <a href=../ProceedJoinPoint/ class=md-nav__link> <span class=md-ellipsis> ProceedJoinPoint </span> </a> </li> <li class=md-nav__item> <a href=../ProceedReturn/ class=md-nav__link> <span class=md-ellipsis> ProceedReturn </span> </a> </li> <li class=md-nav__item> <a href=../Pointcut_return/ class=md-nav__link> <span class=md-ellipsis> Pointcut method return value </span> </a> </li> <li class=md-nav__item> <a href=../Suspend_cut/ class=md-nav__link> <span class=md-ellipsis> Suspend pointcut function </span> </a> </li> <li class=md-nav__item> <a href=../About_obfuscation/ class=md-nav__link> <span class=md-ellipsis> About obfuscation </span> </a> </li> <li class=md-nav__item> <a href=../Implications/ class=md-nav__link> <span class=md-ellipsis> Implications </span> </a> </li> <li class=md-nav__item> <a href=../AspectJ_Migration_Guide/ class=md-nav__link> <span class=md-ellipsis> AspectJ Migration Guide </span> </a> </li> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../give_list/ class=md-nav__link> <span class=md-ellipsis> Tips </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 中文 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 中文 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../zh/ class=md-nav__link> <span class=md-ellipsis> 概述 </span> </a> </li> <li class=md-nav__item> <a href=../zh/getting_started/ class=md-nav__link> <span class=md-ellipsis> 入门 </span> </a> </li> <li class=md-nav__item> <a href=../zh/android_aop_extra/ class=md-nav__link> <span class=md-ellipsis> 扩展库 </span> </a> </li> <li class=md-nav__item> <a href=../zh/AndroidAopPointCut/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopPointCut </span> </a> </li> <li class=md-nav__item> <a href=../zh/AndroidAopMatchClassMethod/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopMatchClassMethod </span> </a> </li> <li class=md-nav__item> <a href=../zh/AndroidAopReplaceClass/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopReplaceClass </span> </a> </li> <li class=md-nav__item> <a href=../zh/AndroidAopModifyExtendsClass/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopModifyExtendsClass </span> </a> </li> <li class=md-nav__item> <a href=../zh/AndroidAopCollectMethod/ class=md-nav__link> <span class=md-ellipsis> @AndroidAopCollectMethod </span> </a> </li> <li class=md-nav__item> <a href=../zh/AOP_Helper/ class=md-nav__link> <span class=md-ellipsis> AOP 代码生成助手 </span> </a> </li> <li class=md-nav__item> <a href=../zh/ProceedJoinPoint/ class=md-nav__link> <span class=md-ellipsis> ProceedJoinPoint </span> </a> </li> <li class=md-nav__item> <a href=../zh/ProceedReturn/ class=md-nav__link> <span class=md-ellipsis> ProceedReturn </span> </a> </li> <li class=md-nav__item> <a href=../zh/Pointcut_return/ class=md-nav__link> <span class=md-ellipsis> 切点方法返回值 </span> </a> </li> <li class=md-nav__item> <a href=../zh/Suspend_cut/ class=md-nav__link> <span class=md-ellipsis> Suspend 切点函数 </span> </a> </li> <li class=md-nav__item> <a href=../zh/About_obfuscation/ class=md-nav__link> <span class=md-ellipsis> 关于混淆 </span> </a> </li> <li class=md-nav__item> <a href=../zh/Implications/ class=md-nav__link> <span class=md-ellipsis> 切面启示 </span> </a> </li> <li class=md-nav__item> <a href=../zh/AspectJ_Migration_Guide/ class=md-nav__link> <span class=md-ellipsis> AspectJ 迁移指南 </span> </a> </li> <li class=md-nav__item> <a href=../zh/FAQ/ class=md-nav__link> <span class=md-ellipsis> 常见问题 </span> </a> </li> <li class=md-nav__item> <a href=../zh/give_list/ class=md-nav__link> <span class=md-ellipsis> 打赏本库 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#brief-description class=md-nav__link> <span class=md-ellipsis> Brief description </span> </a> </li> <li class=md-nav__item> <a href=#1-description class=md-nav__link> <span class=md-ellipsis> 1. Description </span> </a> <nav class=md-nav aria-label="1. Description"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#androidaopreplaceclass class=md-nav__link> <span class=md-ellipsis> @AndroidAopReplaceClass </span> </a> </li> <li class=md-nav__item> <a href=#androidaopreplacenew class=md-nav__link> <span class=md-ellipsis> @AndroidAopReplaceNew </span> </a> </li> <li class=md-nav__item> <a href=#androidaopreplacemethod class=md-nav__link> <span class=md-ellipsis> @AndroidAopReplaceMethod </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-matching-rules class=md-nav__link> <span class=md-ellipsis> 2. Matching rules </span> </a> </li> <li class=md-nav__item> <a href=#3-use-cases class=md-nav__link> <span class=md-ellipsis> 3. Use cases </span> </a> <nav class=md-nav aria-label="3. Use cases"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-java-writing class=md-nav__link> <span class=md-ellipsis> 1. Java writing </span> </a> </li> <li class=md-nav__item> <a href=#2-kotlin-writing-method class=md-nav__link> <span class=md-ellipsis> 2. Kotlin writing method </span> </a> <nav class=md-nav aria-label="2. Kotlin writing method"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#if-the-replaced-function-is-modified-with-suspend-then-you-can-only-write-it-in-kotlin-code-and-the-replacement-function-must-also-be-modified-with-suspend class=md-nav__link> <span class=md-ellipsis> If the replaced function is modified with suspend, then you can only write it in Kotlin code, and the replacement function must also be modified with suspend </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-construction-method class=md-nav__link> <span class=md-ellipsis> 3. Construction method </span> </a> </li> <li class=md-nav__item> <a href=#4-proxy-usage-of-androidaopmatchclassmethod class=md-nav__link> <span class=md-ellipsis> 4. Proxy usage of @AndroidAopMatchClassMethod </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>@AndroidAopReplaceClass</h1> <h2 id=brief-description>Brief description<a class=headerlink href=#brief-description title="Permanent link">&para;</a></h2> <p>This function belongs to the advanced function, special attention should be paid when using it, otherwise it will be invalid</p> <p>This aspect is used to replace the method call in the code, and needs to be used in conjunction with @AndroidAopReplaceMethod. When the replaced method is called, it will enter the method annotated with @AndroidAopReplaceMethod</p> <ul> <li><em>Note that this method is essentially different from the other two. The first two focus on the execution of the method, and automatically retain the method that can execute the original logic (i.e. <a href=https://flyjingfish.github.io/AndroidAOP/ProceedJoinPoint/ >ProceedJoinPoint</a>);</em></li> <li><em>This focuses on the method call, which replaces all the calling places with the static methods of the class you set, and does not automatically retain the method that executes the original logic</em></li> <li><strong><em>The advantage of this method is that it can "equivalently" monitor the call of certain system methods (code in android.jar), and the first two do not have this feature, so if it is not based on this requirement, it is recommended to use <a href=https://flyjingfish.github.io/AndroidAOP/AndroidAopMatchClassMethod/ >@AndroidAopMatchClassMethod</a></em></strong></li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p><li>To sum up, this function can be said to be a supplement to <a href=https://flyjingfish.github.io/AndroidAOP/AndroidAopMatchClassMethod/ >@AndroidAopMatchClassMethod</a> (the code in android.jar cannot be woven into AOP code). The reason why <a href=https://flyjingfish.github.io/AndroidAOP/ProceedJoinPoint/ >ProceedJoinPoint</a> is not used is that this method may be restricted by different versions of Android. It can neither use reflection to call the original method nor weave in AOP code, so it cannot be encapsulated with <a href=/AndroidAOP/ProceedJoinPoint/ >ProceedJoinPoint</a>. If you really want to use it, it is recommended to use <a href=#4-proxy-usage-of-androidaopmatchclassmethod>MatchClassMethodProxy</a> </li><br> <li>Although some system methods can be hooked, in the final analysis, they are calls within the hook installation package, not including calls at the framework layer</li><br> <li><strong>After you modify the configuration of this aspect, you should clean the project before continuing development</strong></li></p> </div> <h2 id=1-description>1. Description<a class=headerlink href=#1-description title="Permanent link">&para;</a></h2> <p><img alt=⚠ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg title=:warning:><img alt=⚠ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg title=:warning:><img alt=⚠ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg title=:warning:> Note: The defined replacement class should be placed within the scan rules you set <a href=https://flyjingfish.github.io/AndroidAOP/getting_started/#4-add-the-androidaopconfig-configuration-item-in-apps-buildgradle-this-step-is-an-optional-configuration-item>here include exclude Rules</a>, it will not work if written outside the scope</p> <h3 id=androidaopreplaceclass>@AndroidAopReplaceClass<a class=headerlink href=#androidaopreplaceclass title="Permanent link">&para;</a></h3> <p><div class="language-kotlin highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nd>@AndroidAopReplaceClass</span><span class=p>(</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;Full name of the class (including package name)&quot;</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Matching</span><span class=w> </span><span class=n>type</span><span class=p>,</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>required</span><span class=p>,</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=n>SELF</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=n>excludeClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>An</span><span class=w> </span><span class=n>array</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>classes</span><span class=w> </span><span class=n>that</span><span class=w> </span><span class=n>exclude</span><span class=w> </span><span class=n>inheritance</span><span class=p>(</span><span class=n>valid</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=k>when</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>SELF</span><span class=p>),</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>required</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=n>excludeWeaving</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>exclude</span><span class=w> </span><span class=n>weaving</span><span class=w> </span><span class=n>range</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>    </span><span class=n>includeWeaving</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>include</span><span class=w> </span><span class=n>weaving</span><span class=w> </span><span class=n>range</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=p>)</span>
</span></code></pre></div> - If the class name filled in by value is an internal class, do not use the <code>$</code> character, but <code>.</code></p> <ul> <li> <p>The annotated class is the replacement class; the parameter is the class to be replaced</p> </li> <li> <p>If the corresponding replaced method exists in the replacement method of the annotated class, it will not participate in the method replacement</p> </li> <li> <p>There are four types of type (if the default <code>SELF</code> is not set, please note the difference from <code>@AndroidAopMatchClassMethod</code>, the default types are different when they are not set):</p> <ul> <li><code>SELF</code> means that the class set by value is matched <strong>itself</strong></li> <li><code>EXTENDS</code> means that <strong>all classes inherited from</strong> the class set by value are matched</li> <li><code>DIRECT_EXTENDS</code> means that the class set by <strong><em><strong>directly inherited</strong></em></strong> is matched</li> <li><code>LEAF_EXTENDS</code> means matching the class set by <strong><em><strong>terminal inheritance (no subclasses)</strong></em></strong> value</li> </ul> <pre class=mermaid><code>graph LR
C(Class C) ---&gt; |Class C inherits from Class B| B{Class B};
B ---&gt;|Class B inherits from Class A| A[Class A];
B ---&gt;|DIRECT_EXTENDS / EXTENDS| A;
C ----&gt;|LEAF_EXTENDS / EXTENDS| A;
D(Class D) ---&gt;|Class D inherits from Class A| A;
D ---&gt;|DIRECT_EXTENDS/ LEAF_EXTENDS / EXTENDS| A;</code></pre> <p>In simple terms, <code>LEAF_EXTENDS</code> and <code>DIRECT_EXTENDS</code> are two extremes. The former focuses on the last node in the inheritance relationship, while the latter focuses on the first node in the inheritance relationship.</p> </li> <li> <p>excludeWeaving and includeWeaving are similar to exclude and include in the <a href=/AndroidAOP/getting_started/#4-add-the-androidaopconfig-configuration-item-in-apps-buildgradle-this-step-is-an-optional-configuration-item>getting started</a></p> </li> </ul> <h3 id=androidaopreplacenew>@AndroidAopReplaceNew<a class=headerlink href=#androidaopreplacenew title="Permanent link">&para;</a></h3> <div class="language-kotlin highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nd>@AndroidAopReplaceNew</span>
</span></code></pre></div> <p>For example, this method changes <code>new Thread()</code> to <code>new MyThread()</code></p> <ul> <li> <p>The annotated method must be public and static, but the method name can be defined arbitrarily</p> </li> <li> <p>There can only be one method parameter, and the parameter is the replaced class</p> <ul> <li>If the replaced class does not inherit the replaced class, then there will be problems with the subsequent object method call. You need to replace all its methods with @AndroidAopReplaceMethod</li> <li>If the replaced class inherits the replaced class, then there will be no problem with the subsequent method call</li> </ul> </li> <li> <p>Is the method return type empty?</p> <ul> <li>If it is not empty, the new object will be called back to this method, and the object returned by this method will also replace the new object. Usually when the return type is not empty, you should define it the same as the parameter type.</li> <li>If it is empty, only the class name after new will be replaced.</li> <li>In any case, the class name after new will become the parameter type of the method.</li> </ul> </li> <li>This will replace all constructor calls.</li> </ul> <h3 id=androidaopreplacemethod>@AndroidAopReplaceMethod<a class=headerlink href=#androidaopreplacemethod title="Permanent link">&para;</a></h3> <div class="language-kotlin highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=s>&quot;Method name (including return value type and parameter type)&quot;</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=p>)</span>
</span></code></pre></div> <ul> <li> <p>The annotated method must be public and static, but the method name can be defined arbitrarily</p> </li> <li> <p>The annotated method is the replacement method; the parameter is the method to be replaced, which must include the return type and parameter type. The matching rules are as follows <a href=https://flyjingfish.github.io/AndroidAOP/AndroidAopReplaceClass/#2-matching-rules>matching rules</a></p> </li> <li> <p>If the replaced method is a static method of the class, the parameter type, order and number of the replacement method you define should be consistent</p> </li> <li> <p>If the replaced method is a member method of a class, the first parameter of the replacement method you define must be the type of the replaced class (this is the meaning of the Toast.show example below), and the remaining parameter types, order, and number are consistent with the replaced method.</p> <ul> <li>There is an exception: the first type can be set to Any (Java is Object). This function is mainly for @AndroidAopReplaceNew not to inherit the replacement class to respond, because the replaced class no longer belongs to the replaced class</li> </ul> </li> <li> <p>The return type of the annotated method is consistent with the replaced method, regardless of whether the replaced method is static or not</p> </li> <li> <p>The replaced method must belong to the replaced class filled in by @AndroidAopReplaceClass</p> </li> <li> <p>If the replaced method starts with <code>&lt;init&gt;</code>, the function is divided into two cases</p> <ul> <li>1、Fill in according to the following requirements. The function is similar to @AndroidAopReplaceNew. The difference is that this will only call back the new class, will not change the new class name, and can specify the construction method. (The object has been created)<ul> <li>The method must have only one parameter, which is the defined class to be replaced (must be equal to the class of @AndroidAopReplaceClass)</li> <li>And the return type cannot be empty (must inherit or be equal to the class of @AndroidAopReplaceClass)</li> <li>The object returned by the method will replace the new object (of course, it is also possible to directly return the callback object)</li> </ul> </li> <li>2、Fill in according to the following requirements. The function is completely different from the previous one. At this time, the object has not been created (this function is available in versions 2.5.8 and above)<ul> <li>The parameters must be exactly the same as the constructor's parameter type and order, and finally a Class type parameter is appended (this is to let you know which class the original constructor belongs to)</li> <li>You need to manually rewrite the code to create the object, because in this case the object has not yet been created (the constructor can be called based on the Class returned to you and the current constructor type)</li> <li>And the return type cannot be empty (must inherit or be equal to the class of @AndroidAopReplaceClass)</li> <li>The object returned by the method will be assigned to the original call</li> </ul> </li> </ul> </li> </ul> <p>For specific writing requirements, please refer to the usage method below</p> <h2 id=2-matching-rules>2. Matching rules<a class=headerlink href=#2-matching-rules title="Permanent link">&para;</a></h2> <p>You can see that the return value type and parameter type are written in the example below. The following is an introduction</p> <p><strong>The difference from <a href=https://flyjingfish.github.io/AndroidAOP/AndroidAopMatchClassMethod/ >@AndroidAopMatchClassMethod</a> is that this must be an exact match, and the writing is as follows:</strong></p> <p>Matching writing formula: <strong>Return value type method name (parameter type, parameter type...)</strong></p> <ul> <li>The return value type, method name, and parameter type must be written in full</li> <li>Wrap the parameter type with <strong>()</strong>, separate multiple parameter types with <strong>,</strong>, and only write <strong>()</strong> if there is no parameter</li> <li>Use a space to separate the return value type and the method name</li> <li><strong>Both the return value type and the parameter type must be represented by Java types</strong>. Except for the 8 basic types, other reference types are <strong>package name.class name</strong></li> <li>If the function is modified with <code>suspend</code>, then the return value type should be written as <code>suspend</code> regardless of the type, and the parameter type should still be written according to the above points</li> <li> <p>For generic information (such as the collection List), the generic information must be erased</p> </li> <li> <p>Different from the replacement class name filled in, if the method parameter and return value type are inner classes, they need to be replaced with <code>$</code> instead of <code>.</code></p> </li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p><a href=https://flyjingfish.github.io/AndroidAOP/AOP_Helper/ >AOP Code Generation Assistant</a>, can help you generate code with one click</p> </div> <p>Below is a table showing different types of Kotlin vs. Java. If it is Kotlin code, please check the corresponding code</p> <p>(If you find any incomplete information, please give me feedback)</p> <table> <thead> <tr> <th>Kotlin type</th> <th style="text-align: center;">Java type</th> </tr> </thead> <tbody> <tr> <td>Int</td> <td style="text-align: center;">int</td> </tr> <tr> <td>Short</td> <td style="text-align: center;">short</td> </tr> <tr> <td>Byte</td> <td style="text-align: center;">byte</td> </tr> <tr> <td>Char</td> <td style="text-align: center;">char</td> </tr> <tr> <td>Long</td> <td style="text-align: center;">long</td> </tr> <tr> <td>Float</td> <td style="text-align: center;">float</td> </tr> <tr> <td>Double</td> <td style="text-align: center;">double</td> </tr> <tr> <td>Boolean</td> <td style="text-align: center;">boolean</td> </tr> <tr> <td>Int?</td> <td style="text-align: center;">java.lang.Integer</td> </tr> <tr> <td>Short?</td> <td style="text-align: center;">java.lang.Short</td> </tr> <tr> <td>Byte?</td> <td style="text-align: center;">java.lang.Byte</td> </tr> <tr> <td>Char?</td> <td style="text-align: center;">java.lang.Character</td> </tr> <tr> <td>Long?</td> <td style="text-align: center;">java.lang.Long</td> </tr> <tr> <td>Float?</td> <td style="text-align: center;">java.lang.Float</td> </tr> <tr> <td>Double?</td> <td style="text-align: center;">java.lang.Double</td> </tr> <tr> <td>Boolean?</td> <td style="text-align: center;">java.lang.Boolean</td> </tr> <tr> <td>String</td> <td style="text-align: center;">java.lang.String</td> </tr> <tr> <td>Unit（Or do not write）</td> <td style="text-align: center;">void</td> </tr> <tr> <td>Unit?</td> <td style="text-align: center;">kotlin.Unit</td> </tr> <tr> <td>Nothing</td> <td style="text-align: center;">java.lang.Void</td> </tr> <tr> <td>Any</td> <td style="text-align: center;">java.lang.Object</td> </tr> </tbody> </table> <p>Other data types not in the table above are reference types, and are written as <strong>package name.class name</strong></p> <div class="admonition note"> <p class=admonition-title>Note</p> <ol> <li><code>vararg str : String</code> in Kotlin is equivalent to <code>String...</code> in Java. In this matching, no matter what kind of code is used, it is represented by <code>String[]</code> (String is used as an example here, and other types are the same)<br></li> <li>For types with generics, do not write generics, for example, <code>java.lang.List&lt;String&gt; methodName(java.lang.List&lt;String&gt;)</code> should be directly written as <code>java.lang.List methodName(java.lang.List)</code></li> </ol> </div> <h2 id=3-use-cases>3. Use cases<a class=headerlink href=#3-use-cases title="Permanent link">&para;</a></h2> <h3 id=1-java-writing>1. Java writing<a class=headerlink href=#1-java-writing title="Permanent link">&para;</a></h3> <div class="language-java highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nd>@AndroidAopReplaceClass</span><span class=p>(</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>        </span><span class=s>&quot;android.widget.Toast&quot;</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=p>)</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReplaceToast</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>            </span><span class=s>&quot;android.widget.Toast makeText(android.content.Context, java.lang.CharSequence, int)&quot;</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>    </span><span class=p>)</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=c1>// Because the replaced method is static, the parameter type and order correspond to the replaced method</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Toast</span><span class=w> </span><span class=nf>makeText</span><span class=p>(</span><span class=n>Context</span><span class=w> </span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>CharSequence</span><span class=w> </span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>duration</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Toast</span><span class=p>.</span><span class=na>makeText</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;ReplaceToast-&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=p>);</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>            </span><span class=s>&quot;void setGravity(int , int , int )&quot;</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=w>    </span><span class=p>)</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=c1>// Because the replaced method is not a static method, the first parameter is the replaced class, and the subsequent parameters correspond to the replaced method</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setGravity</span><span class=p>(</span><span class=n>Toast</span><span class=w> </span><span class=n>toast</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>gravity</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>xOffset</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>yOffset</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=w>        </span><span class=n>toast</span><span class=p>.</span><span class=na>setGravity</span><span class=p>(</span><span class=n>Gravity</span><span class=p>.</span><span class=na>CENTER</span><span class=p>,</span><span class=w> </span><span class=n>xOffset</span><span class=p>,</span><span class=w> </span><span class=n>yOffset</span><span class=p>);</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=w>            </span><span class=s>&quot;void show()&quot;</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=w>    </span><span class=p>)</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=c1>// Although the replaced method has no parameters, because it is not a static method, the first parameter is still the replaced class</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>show</span><span class=p>(</span><span class=n>Toast</span><span class=w> </span><span class=n>toast</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=w>        </span><span class=n>toast</span><span class=p>.</span><span class=na>show</span><span class=p>();</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=p>}</span>
</span></code></pre></div> <p>This example means that all places where <code>Toast.makeText</code> and <code>Toast.show</code> in the code are replaced with <code>ReplaceToast.makeText</code> and <code>ReplaceToast.show</code></p> <h3 id=2-kotlin-writing-method>2. Kotlin writing method<a class=headerlink href=#2-kotlin-writing-method title="Permanent link">&para;</a></h3> <div class="language-kotlin highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nd>@AndroidAopReplaceClass</span><span class=p>(</span><span class=s>&quot;android.util.Log&quot;</span><span class=p>)</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=kd>object</span><span class=w> </span><span class=nc>ReplaceLog</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span><span class=s>&quot;int e(java.lang.String,java.lang.String)&quot;</span><span class=p>)</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=nd>@JvmStatic</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>    </span><span class=kd>fun</span><span class=w> </span><span class=nf>e</span><span class=p>(</span><span class=n>tag</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=p>,</span><span class=w> </span><span class=n>msg</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=p>):</span><span class=w> </span><span class=kt>Int</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Log</span><span class=p>.</span><span class=na>e</span><span class=p>(</span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=s>&quot;ReplaceLog-</span><span class=si>$</span><span class=n>msg</span><span class=s>&quot;</span><span class=p>)</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=p>}</span>
</span></code></pre></div> <p>This example means that all places where <code>Log.e</code> are written in the code are replaced with <code>ReplaceLog.e</code></p> <h4 id=if-the-replaced-function-is-modified-with-suspend-then-you-can-only-write-it-in-kotlin-code-and-the-replacement-function-must-also-be-modified-with-suspend>If the replaced function is modified with <code>suspend</code>, then you can only write it in Kotlin code, and the replacement function must also be modified with <code>suspend</code><a class=headerlink href=#if-the-replaced-function-is-modified-with-suspend-then-you-can-only-write-it-in-kotlin-code-and-the-replacement-function-must-also-be-modified-with-suspend title="Permanent link">&para;</a></h4> <div class="language-kotlin highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nd>@AndroidAopReplaceClass</span><span class=p>(</span><span class=s>&quot;com.flyjingfish.androidaop.MainActivity&quot;</span><span class=p>)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=kd>object</span><span class=w> </span><span class=nc>ReplaceGetData</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=c1>//The only change in the annotation parameter is the return type, which is changed to suspend, and the rest remain unchanged</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span><span class=s>&quot;suspend getData(int)&quot;</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=nd>@JvmStatic</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=c1>// The function definition writing rules here remain unchanged, just add an additional suspend modifier</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>    </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>getData</span><span class=p>(</span><span class=n>mainActivity</span><span class=p>:</span><span class=w> </span><span class=n>MainActivity</span><span class=p>,</span><span class=w> </span><span class=n>num</span><span class=p>:</span><span class=w> </span><span class=kt>Int</span><span class=p>):</span><span class=w> </span><span class=kt>Int</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>        </span><span class=n>Log</span><span class=p>.</span><span class=na>e</span><span class=p>(</span><span class=s>&quot;ReplaceGetData&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;getData&quot;</span><span class=p>)</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>mainActivity</span><span class=p>.</span><span class=na>getData</span><span class=p>(</span><span class=n>num</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=m>1</span><span class=p>)</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=p>}</span>
</span></code></pre></div> <h3 id=3-construction-method>3. Construction method<a class=headerlink href=#3-construction-method title="Permanent link">&para;</a></h3> <div class="language-kotlin highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nd>@AndroidAopReplaceClass</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;com.flyjingfish.test_lib.TestMatch&quot;</span><span class=p>,</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MatchType</span><span class=p>.</span><span class=na>EXTENDS</span><span class=p>)</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=kd>object</span><span class=w> </span><span class=nc>ReplaceTestMatch</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=nd>@AndroidAopReplaceNew</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=nd>@JvmStatic</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>    </span><span class=kd>fun</span><span class=w> </span><span class=nf>newTestMatch1</span><span class=p>(</span><span class=n>testBean</span><span class=p>:</span><span class=w> </span><span class=n>TestMatch3</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>        </span><span class=c1>//Replace the class name after new, the parameter type is the replaced type, the return type of this method is empty, and this method will not be called back</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span><span class=nd>@AndroidAopReplaceNew</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>    </span><span class=nd>@JvmStatic</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>    </span><span class=kd>fun</span><span class=w> </span><span class=nf>newTestMatch2</span><span class=p>(</span><span class=n>testBean</span><span class=p>:</span><span class=w> </span><span class=n>TestMatch3</span><span class=p>):</span><span class=w> </span><span class=n>TestMatch</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>        </span><span class=c1>//Replace the class name after new, the parameter type is the replaced type, and the return type of this method is not empty, then this method will be called back, and the returned object will replace the new object</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>new</span><span class=w> </span><span class=n>TestMatch</span><span class=w> </span><span class=p>()</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span><span class=s>&quot;&lt;init&gt;(int)&quot;</span><span class=p>)</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=w>    </span><span class=nd>@JvmStatic</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=w>    </span><span class=kd>fun</span><span class=w> </span><span class=nf>getTestBean</span><span class=p>(</span><span class=n>testBean</span><span class=p>:</span><span class=w> </span><span class=n>TestMatch</span><span class=p>):</span><span class=w> </span><span class=n>TestMatch</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=w>        </span><span class=c1>//Only one parameter can be the replaced class, the return type cannot be empty, and the object returned by the method will replace the newly created object</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>TestMatch</span><span class=p>(</span><span class=m>2</span><span class=p>)</span>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span><span class=s>&quot;&lt;init&gt;(int)&quot;</span><span class=p>)</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>    </span><span class=nd>@JvmStatic</span>
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=w>    </span><span class=kd>fun</span><span class=w> </span><span class=nf>getTestBean</span><span class=p>(</span><span class=n>num</span><span class=p>:</span><span class=w> </span><span class=kt>Int</span><span class=p>,</span><span class=n>clazz</span><span class=w> </span><span class=p>:</span><span class=n>Class</span><span class=o>&lt;*&gt;</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>TestMatch</span><span class=p>{</span>
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=w>        </span><span class=c1>//The last parameter is of type Class. The types and order of the remaining parameters are exactly the same as the original constructor. The object is created in this method. No object has been created before.</span>
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>TestMatch</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>
</span><span id=__span-6-29><a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-30><a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a>
</span><span id=__span-6-31><a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=p>}</span>
</span></code></pre></div> <p>The above three usage methods can replace the new object. The difference is</p> <ul> <li> <p>The first method directly replaces the new class name (directly replaces the type)</p> </li> <li> <p>The second method not only replaces the new class name, but also calls back to the method. The object returned here will also replace the newly created object (the difference between the two is whether the return type is empty)</p> </li> <li> <p>The third method is different from the first two in that it <strong>does not replace the new class name</strong>, but calls back to the method. The object returned here will replace the newly created object. And the defined parameter must be one and only one type defined by @AndroidAopReplaceClass, and the return type cannot be null</p> </li> <li> <p>The fourth type is different from the first three in that it <strong>will neither replace the new class name nor have an object callback</strong>, you need to manually create this object. Its advantage is that it gets all the parameters for creating the object before the object is created, so that you can modify the parameters in advance and then create the object, <strong>so its advantage is that it has a pre-effect</strong></p> </li> <li> <p>The function defined by @AndroidAopReplaceNew has one and only one parameter, and the parameter type can be any type except the basic type</p> </li> </ul> <h3 id=4-proxy-usage-of-androidaopmatchclassmethod>4. Proxy usage of @AndroidAopMatchClassMethod<a class=headerlink href=#4-proxy-usage-of-androidaopmatchclassmethod title="Permanent link">&para;</a></h3> <ul> <li> <ol> <li>First, you must still use <code>@AndroidAopReplaceClass</code> to replace the method call, and use <code>@ProxyMethod</code> to add annotations to the replacement method</li> </ol> </li> <li> <p>The replaced method needs to be called in the method implementation</p> </li> <li>In addition to the requirements mentioned above, the definition of the method must be consistent with the original method, such as the name, annotations, parameter names, annotations on parameters, etc. of the original method. If you don't use this information, it doesn't matter. If you want to use it, you must do so</li> </ul> <div class="language-java highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>package</span><span class=w> </span><span class=nn>com.flyjingfish.test_lib.replace</span><span class=p>;</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=nd>@AndroidAopReplaceClass</span><span class=p>(</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>        </span><span class=s>&quot;android.widget.Toast&quot;</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=p>)</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReplaceToast</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>            </span><span class=s>&quot;android.widget.Toast makeText(android.content.Context, java.lang.CharSequence, int)&quot;</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>    </span><span class=p>)</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>    </span><span class=nd>@ProxyMethod</span><span class=p>(</span><span class=n>proxyClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Toast</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ProxyType</span><span class=p>.</span><span class=na>STATIC_METHOD</span><span class=p>)</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Toast</span><span class=w> </span><span class=nf>makeText</span><span class=p>(</span><span class=n>Context</span><span class=w> </span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>CharSequence</span><span class=w> </span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>duration</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Toast</span><span class=p>.</span><span class=na>makeText</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=p>);</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>            </span><span class=s>&quot;void setGravity(int , int , int )&quot;</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>    </span><span class=p>)</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>    </span><span class=nd>@ProxyMethod</span><span class=p>(</span><span class=n>proxyClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Toast</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ProxyType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setGravity</span><span class=p>(</span><span class=n>Toast</span><span class=w> </span><span class=n>toast</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>gravity</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>xOffset</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>yOffset</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>        </span><span class=n>toast</span><span class=p>.</span><span class=na>setGravity</span><span class=p>(</span><span class=n>gravity</span><span class=p>,</span><span class=w> </span><span class=n>xOffset</span><span class=p>,</span><span class=w> </span><span class=n>yOffset</span><span class=p>);</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w>    </span><span class=nd>@AndroidAopReplaceMethod</span><span class=p>(</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w>            </span><span class=s>&quot;void show()&quot;</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>    </span><span class=p>)</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>    </span><span class=nd>@ProxyMethod</span><span class=p>(</span><span class=n>proxyClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Toast</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ProxyType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>show</span><span class=p>(</span><span class=n>Toast</span><span class=w> </span><span class=n>toast</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=w>        </span><span class=n>toast</span><span class=p>.</span><span class=na>show</span><span class=p>();</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=p>}</span>
</span></code></pre></div> <ul> <li> <ol> <li>Use <code>@AndroidAopMatchClassMethod</code> to define the <code>ReplaceToast</code> proxy class</li> </ol> </li> <li>type needs to be MatchType.SELF</li> <li>Use MatchClassMethodProxy or MatchClassMethodSuspendProxy class as the aspect processing class</li> <li>Implement the invokeProxy or invokeSuspendProxy method to handle the logic</li> </ul> <div class="language-kotlin highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=nd>@AndroidAopMatchClassMethod</span><span class=p>(</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>    </span><span class=n>targetClassName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;com.flyjingfish.test_lib.replace.ReplaceToast&quot;</span><span class=p>,</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MatchType</span><span class=p>.</span><span class=na>SELF</span><span class=p>,</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=n>methodName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=s>&quot;*&quot;</span><span class=o>]</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=p>)</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=kd>class</span><span class=w> </span><span class=nc>ReplaceToastProxy</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>MatchClassMethodProxy</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>invokeProxy</span><span class=p>(</span><span class=n>joinPoint</span><span class=p>:</span><span class=w> </span><span class=n>ProceedJoinPoint</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=p>):</span><span class=w> </span><span class=kt>Any?</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>        </span><span class=n>Log</span><span class=p>.</span><span class=na>e</span><span class=p>(</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>            </span><span class=s>&quot;ReplaceToastProxy&quot;</span><span class=p>,</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>            </span><span class=s>&quot;methodName=</span><span class=si>$</span><span class=n>methodName</span><span class=s>,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;parameterNames=</span><span class=si>${</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>targetMethod</span><span class=p>.</span><span class=na>parameterNames</span><span class=p>.</span><span class=na>toList</span><span class=p>()</span><span class=si>}</span><span class=s>,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;parameterTypes=</span><span class=si>${</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>targetMethod</span><span class=p>.</span><span class=na>parameterTypes</span><span class=p>.</span><span class=na>toList</span><span class=p>()</span><span class=si>}</span><span class=s>,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;returnType=</span><span class=si>${</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>targetMethod</span><span class=p>.</span><span class=na>returnType</span><span class=si>}</span><span class=s>,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;args=</span><span class=si>${</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>args</span><span class=o>?.</span><span class=na>toList</span><span class=p>()</span><span class=si>}</span><span class=s>,target=</span><span class=si>${</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>target</span><span class=si>}</span><span class=s>,targetClass=</span><span class=si>${</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>targetClass</span><span class=si>}</span><span class=s>,&quot;</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>        </span><span class=p>)</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>proceed</span><span class=p>()</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=p>}</span>
</span></code></pre></div> <p>So you can For some system methods, <code>ProceedJoinPoint</code> is used to control the method call. The key is to use <code>@ProxyMethod</code> to mark the method, so that the information returned by <code>ProceedJoinPoint</code> is the method information of the replaced class&gt; </p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><a href=https://flyjingfish.github.io/AndroidAOP/AOP_Helper/ >AOP code generation assistant</a>, which can help you generate proxy usage code with one click</p> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../AndroidAopMatchClassMethod/ class="md-footer__link md-footer__link--prev" aria-label="Previous: @AndroidAopMatchClassMethod"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> @AndroidAopMatchClassMethod </div> </div> </a> <a href=../AndroidAopModifyExtendsClass/ class="md-footer__link md-footer__link--next" aria-label="Next: @AndroidAopModifyExtendsClass"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> @AndroidAopModifyExtendsClass </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023-2025 FlyJingFish </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/FlyJingFish target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href="https://qm.qq.com/cgi-bin/qm/qr?k=w2qDbv_5bpLl0lO0qjXxijl3JHCQgtXx&jump_from=webapi&authKey=Q6/YB+7q9BvOGbYv1qXZGAZLigsfwaBxDC8kz03/5Pwy7018XunUcHoC11kVLqCb" target=_blank rel=noopener title=qm.qq.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M434.1 420.4c-11.5 1.4-44.9-52.7-44.9-52.7 0 31.3-16.1 72.2-51 101.8 16.8 5.2 54.8 19.2 45.8 34.4-7.3 12.3-125.5 7.9-159.6 4-34.1 3.8-152.3 8.3-159.6-4-9-15.2 28.9-29.2 45.8-34.4-34.9-29.5-51.1-70.4-51.1-101.8 0 0-33.3 54.1-44.9 52.7-5.4-.6-12.4-29.6 9.3-99.7 10.3-33 22-60.5 40.1-105.8C60.9 98 109.2-.1 224.3-.1 338-.1 387.5 96 384.6 214.9c18.1 45.2 29.9 72.9 40.1 105.8 21.8 70.1 14.7 99.1 9.3 99.7z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.92b07e13.min.js></script> <script src=../js/language-switch.js></script> <script src=../js/header-button.js></script> <script src=../js/logo_anim.js></script> </body> </html>